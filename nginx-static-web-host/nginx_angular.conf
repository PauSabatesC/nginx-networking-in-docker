
user  nginx;
# To know how many workers put run: 'grep processor /proc/cpuinfo | wc -l'
worker_processes  1;

pid        /var/run/nginx.pid;

events {
    # To know how many connections handle simultaniously run: 'ulimit -n'
    worker_connections  1024;
}

http {     
    
    charset utf-8;
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;


    server {
        listen       80;
        server_name  localhost;

        # log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
        #                   '$status $body_bytes_sent "$http_referer" '
        #                   '"$http_user_agent" "$http_x_forwarded_for"';
        
        # access_log  /var/log/nginx/access.log  main;
        access_log  /var/log/nginx/$host.access.log;
        error_log  /var/log/nginx/$host.error.log;

        root  /usr/share/nginx/html;
        index  index.html index.htm;

        location / {
            try_files $uri$args $uri$args/ /index.html;

            # A negative value means that the response expires immediately.
            # Nginx automatically sets the `Cache-Control: no-cache` header, if `expires` is negative
            #
            expires           -1;
            
            add_header        Strict-Transport-Security "max-age=31449600; includeSubDomains" always;    
            add_header        Content-Security-Policy "object-src 'none'; script-src 'self'; script-src-elem 'self'; base-uri 'self'; require-trusted-types-for 'script'" always;
            add_header        X-Frame-Options "DENY" always;	
            add_header        X-Content-Type-Options "nosniff" always;
            add_header        Referrer-Policy "strict-origin" always;
            add_header        Feature-Policy "microphone 'none'; geolocation 'none'; camera 'none'" always;
            add_header        Permissions-Policy "geolocation=(),midi=(),sync-xhr=(),microphone=(),camera=(),magnetometer=(),gyroscope=(),fullscreen=(self),payment=()";
        }

        # this block will catch files that might need to change immediately (e. g. to deploy hotfixes), such as js or css
        # The ?: prefix is a 'non-capturing' mark, meaning we do not require
        # the pattern to be captured into $1 which should help improve performance
        location ~* \.(?:css|js)$ {
            access_log        off;
            log_not_found     off;

            # no-cache:         forces caches to submit the request to the origin server for validation before releasing a 
            #                   cached copy, every time. This is useful to assure that authentication is respected 
            #                   (in combination with public), or to maintain rigid freshness, without sacrificing all of the 
            #                   benefits of caching.
            # 
            # public:           marks authenticated responses as cacheable; normally, if HTTP authentication is required, 
            #                   responses are automatically private.
            #
            # must-revalidate:  tells caches that they must obey any freshness information you give them about a 
            #                   representation. HTTP allows caches to serve stale representations under special conditions;
            #                   by specifying this header, youâ€™re telling the cache that you want it to strictly follow 
            #                   your rules.
            # 
            # proxy-revalidate: similar to must-revalidate, except that it only applies to proxy caches.
            # 
            add_header        Cache-Control "no-cache, public, must-revalidate, proxy-revalidate";
            add_header        Strict-Transport-Security "max-age=31449600; includeSubDomains" always;    
            add_header        Content-Security-Policy "object-src 'none'; script-src 'self'; script-src-elem 'self'; base-uri 'self'; require-trusted-types-for 'script'" always;
            add_header        X-Frame-Options "DENY" always;	
            add_header        X-Content-Type-Options "nosniff" always;
            add_header        Referrer-Policy "strict-origin" always;
            add_header        Feature-Policy "microphone 'none'; geolocation 'none'; camera 'none'" always;
            add_header        Permissions-Policy "geolocation=(),midi=(),sync-xhr=(),microphone=(),camera=(),magnetometer=(),gyroscope=(),fullscreen=(self),payment=()";
        }
        

        # This block will catch static file requests, such as images
        # The ?: prefix is a 'non-capturing' mark, meaning we do not require
        # the pattern to be captured into $1 which should help improve performance
        location ~* \.(?:jpg|jpeg|gif|png|ico|xml)$ {
            access_log        off;
            log_not_found     off;

            # The Expires HTTP header is a basic means of controlling caches; it tells all caches how long 
            # the associated representation is fresh for. After that time, caches will always check back with 
            # the origin server to see if a document is changed.
            #
            # "If a request includes the no-cache directive, it SHOULD NOT include min-fresh, max-stale, or max-age." 
            # (source: http://www.ietf.org/rfc/rfc2616.txt, p114)
            #
            # Nginx automatically sets the `Cache-Control: max-age=t` header, if `expires` is present, where t is a time 
            # specified in the directive, in seconds. Shortcuts for time can be used, for example 5m for 5 minutes.
            #
            expires           5m;

            # public:           marks authenticated responses as cacheable; normally, if HTTP authentication is required, 
            #                   responses are automatically private.
            # 
            add_header        Cache-Control "public";
            
            add_header        Strict-Transport-Security "max-age=31449600; includeSubDomains" always;    
            add_header        Content-Security-Policy "object-src 'none'; script-src 'self'; script-src-elem 'self'; base-uri 'self'; require-trusted-types-for 'script'" always;
            add_header        X-Frame-Options "DENY" always;	
            add_header        X-Content-Type-Options "nosniff" always;
            add_header        Referrer-Policy "strict-origin" always;
            add_header        Feature-Policy "microphone 'none'; geolocation 'none'; camera 'none'" always;
            add_header        Permissions-Policy "geolocation=(),midi=(),sync-xhr=(),microphone=(),camera=(),magnetometer=(),gyroscope=(),fullscreen=(self),payment=()";
        }
        
        # This block will catch static file requests of fonts and allows fonts to be requested via CORS
        # The ?: prefix is a 'non-capturing' mark, meaning we do not require
        # the pattern to be captured into $1 which should help improve performance
        location ~* \.(?:eot|woff|woff2|ttf|svg|otf) {
            access_log        off;
            log_not_found     off;

            # The Expires HTTP header is a basic means of controlling caches; it tells all caches how long
            # the associated representation is fresh for. After that time, caches will always check back with
            # the origin server to see if a document is changed.
            #
            # "If a request includes the no-cache directive, it SHOULD NOT include min-fresh, max-stale, or max-age."
            # (source: http://www.ietf.org/rfc/rfc2616.txt, p114)
            #
            # Nginx automatically sets the `Cache-Control: max-age=t` header, if `expires` is present, where t is a time
            # specified in the directive, in seconds. Shortcuts for time can be used, for example 5m for 5 minutes.
            #
            expires           5m;

            # public:           marks authenticated responses as cacheable; normally, if HTTP authentication is required,
            #                   responses are automatically private.
            #
            add_header        Cache-Control "public";
            add_header        Access-Control-Allow-Origin *;

            add_header        Strict-Transport-Security "max-age=31449600; includeSubDomains" always;    
            add_header        Content-Security-Policy "object-src 'none'; script-src 'self'; script-src-elem 'self'; base-uri 'self'; require-trusted-types-for 'script'" always;
            add_header        X-Frame-Options "DENY" always;	
            add_header        X-Content-Type-Options "nosniff" always;
            add_header        Referrer-Policy "strict-origin" always;
            add_header        Feature-Policy "microphone 'none'; geolocation 'none'; camera 'none'" always;
            add_header        Permissions-Policy "geolocation=(),midi=(),sync-xhr=(),microphone=(),camera=(),magnetometer=(),gyroscope=(),fullscreen=(self),payment=()";

            types     {font/opentype otf;}
            types     {application/vnd.ms-fontobject eot;}
            types     {font/truetype ttf;}
            types     {application/font-woff woff;}
            types     {font/x-woff woff2;}
        }

        # this prevents hidden files (beginning with a period) from being served
        location ~ /\. { 
            access_log        off; 
            log_not_found     off; 
            deny              all; 
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }

        error_page   404 400  /40x.html;
        location = /40x.html {
            root   /usr/share/nginx/html;
        }

        # gzip             on;
        # gzip_comp_level  2;
        # gzip_min_length  1000;
        # gzip_proxied     expired no-cache no-store private auth;
        # gzip_types       text/plain application/x-javascript text/xml text/css application/xml;
    }

}
